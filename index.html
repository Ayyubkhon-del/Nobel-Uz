<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NOBEL UZ | –û–ù–õ–ê–ô–ù –ú–ê–ì–ê–ó–ò–ù</title>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <style>
    /* ... –°–¢–ò–õ–ò –û–°–¢–ê–Æ–¢–°–Ø –ö–ê–ö –í–ê–®–ò ... */
    /* (–º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Å—é–¥–∞: https://github.com/Ayyubkhon-del/Nobel-Uz/blob/main/index.html) */
    :root { --bg: #0b0b0b; --card: #141414; --gold: #ffd166; --gold-dark: #b8860b; --muted: #dcdcdc; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: "Inter", "Segoe UI", Arial, sans-serif; background: radial-gradient(1200px 400px at 10% 10%, rgba(255, 215, 0, 0.03), transparent), linear-gradient(180deg, var(--bg), #050505 60%); color: var(--muted); min-height: 100vh; display: flex; flex-direction: column; }
    /* ... (–æ—Å—Ç–∞–ª—å–Ω–æ–π CSS –∫–∞–∫ –≤ –≤–∞—à–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª–µ) ... */
    .admin-panel { display: none; background: linear-gradient(180deg, #111, #0f0f0f); border: 1px solid rgba(255,215,0,0.06); padding: 16px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.6); margin: 20px auto; max-width: 1200px; color: var(--gold); }
    /* ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ ... */
  </style>
</head>
<body>
<header>
  <h1>NOBEL UZ | –û–ù–õ–ê–ô–ù –ú–ê–ì–ê–ó–ò–ù</h1>
  <nav>
    <a href="https://www.instagram.com/nobel_uz1" target="_blank" rel="noopener">Instagram</a>
    <a href="https://t.me/+X5m5jCOv7tVlMmYy" target="_blank" rel="noopener">Telegram</a>
    <a href="tel:+998950670856">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</a>
  </nav>
  <div class="btn-container">
    <button class="btn" onclick="toggleInfo()">–ò–Ω—Ñ–æ</button>
    <button class="delivery-btn" onclick="openDeliveryInfo()">–î–æ—Å—Ç–∞–≤–∫–∞</button>
  </div>
  <div id="cartIcon" onclick="toggleCart()">
    <svg viewBox="0 0 24 24">
      <path d="M7 18c-1.104 0-2 .896-2 2s.896 2 2 2 2-.896 2-2-.896-2-2-2zm10 0c-1.104 0-2 .896-2 2s.896 2 2 2 2-.896 2-2-.896-2-2-2zM7.16 15h9.74c.79 0 1.51-.47 1.83-1.18l3.24-7.02c.19-.41.03-.89-.39[...]"/>
    </svg>
    <span id="cartCount">0</span>
  </div>
</header>

<div class="wrap">
  <section id="infoBlock" class="info-block" aria-label="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ –∏ —É—Å–ª–æ–≤–∏—è—Ö" style="display:none;">
    <p>‚ú®üá∫üáø –û—Ä–∏–≥–∏–Ω–∞–ª & –õ—é–∫—Å-–∫–æ–ø–∏–∏ –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞</p>
    <ul>
      <li>–î–æ—Å—Ç–∞–≤–∫–∞: 7‚Äì14 –¥–Ω–µ–π</li>
      <li>–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ –≤—Å–µ–º—É –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω—É</li>
      <li>–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ 50%</li>
      <li>–í–æ–∑–≤—Ä–∞—Ç–∞ –Ω–µ—Ç‚ùóÔ∏è</li>
    </ul>
  </section>

  <div id="adminPanel" class="admin-panel" aria-hidden="true">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-weight: 800;">
      –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
      <span style="font-size: 0.9rem; color: rgba(255,255,255,0.7)">–¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</span>
    </div>
    <div class="admin-grid">
      <input id="productName" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
      <input id="productPrice" type="text" placeholder="–¶–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä 249.000 + kargo)" />
      <input id="productImageFile" type="file" accept="image/*" multiple />
    </div>
    <div class="admin-bottom">
      <button class="btn" onclick="addProduct()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
      <button class="btn" style="background: transparent; color: var(--gold); border: 1px solid rgba(255,215,0,0.08)" onclick="clearProducts()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
    </div>
  </div>

  <section id="productList"></section>
</div>

<section id="cart" style="display:none;">
  <button class="close-cart" onclick="toggleCart()">√ó</button>
  <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
  <ul id="cartItems"></ul>
  <div class="total">–ò—Ç–æ–≥–æ: <span id="cartTotal">0</span> —Å—É–º</div>
</section>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞ -->
<div id="modalOverlay">
  <div id="modalCard"></div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ -->
<div id="deliveryModal" style="display:none;position:fixed;z-index:999999;left:0;top:0;width:100vw;height:100vh; background:rgba(10,10,10,0.93);align-items:center;justify-content:center;">
  <div style="background:var(--card);border-radius:18px;box-shadow:0 10px 60px rgba(0,0,0,0.5);min-width:320px;max-width:95vw;min-height:120px;max-height:80vh;padding:32px;color:var(--gold);display:fl[...]
    <button onclick="closeDeliveryInfo()" style="position:absolute;right:18px;top:18px;background:transparent;color:var(--gold);border:none;font-size:2rem;cursor:pointer;font-weight:bold;">√ó</button>
    <h2 style="margin-top:0;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ</h2>
    <div id="deliveryContent" style="font-size:1.1rem;line-height:1.7;text-align:center;">
      –î–æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ –≤—Å–µ–º—É –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω—É.<br>
      –ü–æ –≥–æ—Ä–æ–¥—É –¢–∞—à–∫–µ–Ω—Ç –¥–æ—Å—Ç–∞–≤–∫–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –ø–æ <b>–Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç–µ</b>.<br>
      –ü–æ –æ–±–ª–∞—Å—Ç—è–º –¥–æ—Å—Ç–∞–≤–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ –ø–æ—á—Ç–æ–≤—ã–µ —Å–ª—É–∂–±—ã <b>BTS</b> –∏ <b>–£–∑–ø–æ—Å—Ç</b>.<br><br>
      <div style="margin-top:10px;">
        <a href="https://bts.uz/" target="_blank" style="color:#ffd166;text-decoration:underline;margin-right:18px;">BTS Express</a>
        <a href="https://uzpost.uz/" target="_blank" style="color:#ffd166;text-decoration:underline;">Uzpost</a>
      </div>
    </div>
  </div>
</div>

<script>
/* --- –í–°–¢–ê–í–¨ –°–í–û–ò –ö–õ–Æ–ß–ò –°–Æ–î–ê --- */
const firebaseConfig = {
  apiKey: "–í–ê–®_API_KEY",
  authDomain: "–í–ê–®_PROJECT_ID.firebaseapp.com",
  projectId: "–í–ê–®_PROJECT_ID",
  storageBucket: "–í–ê–®_PROJECT_ID.appspot.com",
  messagingSenderId: "–í–ê–®_SENDER_ID",
  appId: "–í–ê–®_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* --- –û–°–¢–ê–õ–¨–ù–û–ô –ö–û–î --- */
const adminPassword = "adminnobe2009@"; // –ø–∞—Ä–æ–ª—å –¥–ª—è –∞–¥–º–∏–Ω–∫–∏

function toggleInfo() {
  const info = document.getElementById("infoBlock");
  const isHidden = info.style.display === "none" || info.style.display === "";
  info.style.display = isHidden ? "block" : "none";
  info.setAttribute("aria-hidden", !isHidden);
}

function openDeliveryInfo() {
  document.getElementById('deliveryModal').style.display = 'flex';
}
function closeDeliveryInfo() {
  document.getElementById('deliveryModal').style.display = 'none';
}

document.addEventListener("keydown", function (e) {
  if (e.ctrlKey && e.altKey && ['1', '2', '3'].includes(e.key)) {
    const enteredPassword = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:");
    if (enteredPassword === adminPassword) {
      const panel = document.getElementById("adminPanel");
      const isHidden = panel.style.display === "none" || panel.style.display === "";
      panel.style.display = isHidden ? "block" : "none";
      panel.setAttribute("aria-hidden", !isHidden);
    } else {
      alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
    }
  }
  if (e.key === "Escape") closeDeliveryInfo();
});

/* --- FIRESTORE: –¢–û–í–ê–†–´ --- */
let products = [];
let cart = JSON.parse(localStorage.getItem("cart")) || [];

function loadProducts() {
  db.collection("products")
    .orderBy("name")
    .get()
    .then(snapshot => {
      products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      renderProducts();
    });
}

function addProduct() {
  const name = document.getElementById("productName").value.trim();
  const price = document.getElementById("productPrice").value.trim();
  const imageFileInput = document.getElementById("productImageFile");
  const files = Array.from(imageFileInput.files);

  if (!name) { alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"); return; }
  if (!price) { alert("–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É"); return; }
  if (!files.length) { alert("–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"); return; }

  let loadedImages = [];
  let loadedCount = 0;
  files.forEach((file, idx) => {
    const reader = new FileReader();
    reader.onload = function(e) {
      loadedImages[idx] = e.target.result;
      loadedCount++;
      if (loadedCount === files.length) {
        db.collection("products").add({ name, price, images: loadedImages }).then(() => {
          loadProducts();
          document.getElementById("productName").value = "";
          document.getElementById("productPrice").value = "";
          imageFileInput.value = "";
        });
      }
    };
    reader.readAsDataURL(file);
  });
}

function clearProducts() {
  if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã?")) {
    db.collection("products").get().then(snapshot => {
      const batch = db.batch();
      snapshot.docs.forEach(doc => batch.delete(doc.ref));
      batch.commit().then(() => {
        loadProducts();
        clearCart();
      });
    });
  }
}

/* --- –í–´–í–û–î –¢–û–í–ê–†–û–í --- */
function renderProducts() {
  const list = document.getElementById("productList");
  list.innerHTML = "";
  products.forEach((p, i) => {
    const card = document.createElement("div");
    card.className = "product-card";
    card.tabIndex = 0;
    card.setAttribute("aria-label", p.name);

    // carousel id
    const carouselId = `carousel-${i}`;
    card.innerHTML = `
      <div class="carousel" id="${carouselId}">
        ${p.images.map((img,j) =>
          `<img src="${img}" alt="${p.name}" data-idx="${j}" class="${j===0?'active':''}" draggable="false"/>`
        ).join('')}
        <div class="carousel-dots" id="${carouselId}-dots">
          ${p.images.map((_,j) =>
            `<span class="carousel-dot${j===0?' active':''}" data-idx="${j}"></span>`
          ).join('')}
        </div>
      </div>
      <h3>${p.name}</h3>
      <div class="price">${p.price}</div>
      <button onclick="addToCart(${i});event.stopPropagation();">–í –∫–æ—Ä–∑–∏–Ω—É</button>
    `;
    list.appendChild(card);
    let curImg = 0;
    const imgs = card.querySelectorAll('.carousel img');
    const dots = card.querySelectorAll('.carousel-dot');
    const carousel = card.querySelector('.carousel');
    function showImg(idx) {
      imgs.forEach((img,j)=>img.classList.toggle('active',j===idx));
      dots.forEach((dot,j)=>dot.classList.toggle('active',j===idx));
      curImg = idx;
    }
    function nextImg() { showImg((curImg+1)%imgs.length); }
    function prevImg() { showImg((curImg-1+imgs.length)%imgs.length); }
    card.querySelector('.carousel-dots').addEventListener('click', function(e){
      if(e.target.classList.contains('carousel-dot')){
        showImg(Number(e.target.dataset.idx));
      }
    });
    let startX = null;
    carousel.addEventListener('touchstart', function(e){ startX = e.touches[0].clientX; });
    carousel.addEventListener('touchend', function(e){
      if(startX !== null){
        let endX = e.changedTouches[0].clientX;
        if(endX < startX - 30) nextImg();
        if(endX > startX + 30) prevImg();
        startX = null;
      }
    });
    carousel.addEventListener('click', function(e){ nextImg(); });

    card.addEventListener("click", function(e){
      if (e.target.tagName === "BUTTON" || e.target.classList.contains('carousel-dot')) return;
      showModalProduct(i, curImg);
    });
  });
}

/* --- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –¢–û–í–ê–†–ê --- */
function showModalProduct(idx, startImgIdx=0) {
  const modalOverlay = document.getElementById("modalOverlay");
  const modalCard = document.getElementById("modalCard");
  const p = products[idx];
  let curImg = startImgIdx;

  function renderModalContent() {
    modalCard.innerHTML = `
      <button class="close-modal" onclick="closeModalProduct()">√ó</button>
      <div class="modal-carousel" id="modalCarousel">
        ${p.images.map((img, i) => `
          <img src="${img}" style="" class="${i===curImg?'active':''}" draggable="false" alt="–¢–æ–≤–∞—Ä"/>
        `).join('')}
        <div class="modal-dots" id="modalDots">
          ${p.images.map((_,i) => `<span class="modal-dot${i===curImg?' active':''}" data-idx="${i}"></span>`).join('')}
        </div>
      </div>
      <h3>${p.name}</h3>
      <div class="price">${p.price}</div>
      <button onclick="addToCart(${idx});closeModalProduct();">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
    `;
    const imgs = modalCard.querySelectorAll(".modal-carousel img");
    const dots = modalCard.querySelectorAll(".modal-dot");
    let startX = null;
    modalCard.querySelector(".modal-carousel").addEventListener("touchstart", function(e){
      startX = e.touches[0].clientX;
    });
    modalCard.querySelector(".modal-carousel").addEventListener("touchend", function(e){
      if(startX !== null){
        let endX = e.changedTouches[0].clientX;
        if(endX < startX - 30) nextModalImg();
        if(endX > startX + 30) prevModalImg();
        startX = null;
      }
    });
    modalCard.querySelector(".modal-carousel").addEventListener("click", function(e){ nextModalImg(); });
    modalCard.querySelector(".modal-dots").addEventListener("click", function(e){
      if(e.target.classList.contains('modal-dot')){
        showImg(Number(e.target.dataset.idx));
      }
    });
    function showImg(idx) {
      imgs.forEach((img,i)=>img.classList.toggle('active',i===idx));
      dots.forEach((dot,i)=>dot.classList.toggle('active',i===idx));
      curImg = idx;
    }
    function nextModalImg() { showImg((curImg+1)%imgs.length); }
    function prevModalImg() { showImg((curImg-1+imgs.length)%imgs.length); }
  }
  renderModalContent();

  modalOverlay.classList.add("active");
  modalOverlay.onclick = function(e) { if (e.target === modalOverlay) closeModalProduct(); };
  document.onkeydown = function(e) { if(e.key === "Escape") closeModalProduct(); };
  window.closeModalProduct = function() {
    modalOverlay.classList.remove("active");
    modalOverlay.onclick = null;
    document.onkeydown = null;
    setTimeout(()=>{modalCard.innerHTML=""},300);
  };
}

/* --- –ö–û–†–ó–ò–ù–ê --- */
function addToCart(index) {
  const product = products[index];
  let found = cart.find(item => item.name === product.name && item.price === product.price);
  if (found) {
    found.count += 1;
  } else {
    cart.push({ ...product, count: 1 });
  }
  saveCart();
  renderCart();
  showCartIconCount();
  showCartAnimated();
}

function saveCart() {
  localStorage.setItem("cart", JSON.stringify(cart));
}
function renderCart() {
  const cartList = document.getElementById("cartItems");
  const totalElem = document.getElementById("cartTotal");
  const cartCountElem = document.getElementById("cartCount");
  if (!cart.length) {
    closeCart();
  }
  cartList.innerHTML = "";
  let total = 0;
  cart.forEach((item, i) => {
    let priceNum = parseFloat(item.price.replace(/[^\d.]/g, "")) || 0;
    total += priceNum * item.count;
    cartList.innerHTML += `
      <li>
      <span>${item.name} - ${item.price}</span>
      <span>
        <button onclick="changeCartCount(${i}, -1)">‚àí</button>
        <span style="display:inline-block;min-width:22px;text-align:center;">${item.count}</span>
        <button onclick="changeCartCount(${i}, 1)">+</button>
        <button onclick="removeFromCart(${i})" style="margin-left:10px;">‚úï</button>
      </span>
      </li>
    `;
  });
  totalElem.textContent = total ? total.toFixed(2) : "0";
  cartCountElem.textContent = cart.reduce((sum, item) => sum + item.count, 0);
}
function changeCartCount(index, delta) {
  cart[index].count += delta;
  if (cart[index].count <= 0) {
    cart.splice(index, 1);
  }
  saveCart();
  renderCart();
  showCartIconCount();
  if (!cart.length) closeCart();
}
function removeFromCart(i) {
  cart.splice(i, 1);
  saveCart();
  renderCart();
  showCartIconCount();
  if (!cart.length) closeCart();
}
function clearCart() {
  cart = [];
  saveCart();
  renderCart();
  showCartIconCount();
  closeCart();
}
function showCartIconCount() {
  const cartCountElem = document.getElementById("cartCount");
  cartCountElem.textContent = cart.reduce((sum, item) => sum + item.count, 0);
}
function toggleCart() {
  const cartSection = document.getElementById("cart");
  if (cartSection.classList.contains("visible")) {
    cartSection.classList.remove("visible");
    setTimeout(() => {cartSection.style.display = "none";}, 400);
  } else {
    cartSection.style.display = "block";
    setTimeout(() => {cartSection.classList.add("visible");}, 10);
    renderCart();
  }
}
function closeCart() {
  const cartSection = document.getElementById("cart");
  cartSection.classList.remove("visible");
  setTimeout(() => {cartSection.style.display = "none";}, 400);
}
function showCartAnimated() {
  const cartSection = document.getElementById("cart");
  cartSection.style.display = "block";
  setTimeout(() => {cartSection.classList.add("visible");}, 10);
  renderCart();
}

/* --- –ó–ê–ü–£–°–ö --- */
loadProducts();
renderCart();
showCartIconCount();

</script>
</body>
</html>
